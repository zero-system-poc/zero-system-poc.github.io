"use strict";chill_penguin.module("popover",(()=>{let e,t={};return{initialize:()=>{e=chill_penguin.popover,t={},e.setup(),e.event_listeners.initialize()},setup:()=>{document.querySelectorAll("[data-module='popover']").forEach(((o,r)=>{const a=o.getAttribute("id");t[a]={el:o,focusable_elements:[],remove_focusable_elements:[]},e.a11y.get_focusable_elements(a)}))},ui:{set_location:e=>{const{el:o}=t[e],r=document.querySelector("[data-module='popover.trigger'][data-popover-trigger='active']");if(chill_penguin.client.viewport.is_md_down())o.style.top="initial",o.style.left="0px",o.style.transform="none";else if(chill_penguin.client.viewport.is_lg_up()){const e=window.pageYOffset||r.scrollTop,t=r.getBoundingClientRect();switch(o.getAttribute("data-popover-direction")){case"top":o.style.left=`${t.left+t.width/2}px`,o.style.transform="translate(-50%,-100%)",o.style.top=t.top+e-16+"px";break;case"bottom":o.style.left=`${t.left+t.width/2}px`,o.style.transform="translateX(-50%)",o.style.top=`${t.top+e+t.height+16}px`;break;default:o.style.top=`${t.top+t.height/2+e}px`,o.style.transform="translateY(-50%)",o.style.left=`${t.left+t.width+16}px`}}}},event_listeners:{initialize:t=>{e.event_listeners.resize()},resize:()=>{chill_penguin.resize_observer(document.querySelector("body"),(()=>{document.querySelector("[data-module='popover'][data-popover='active']")&&e.ui.set_location(document.querySelector("[data-module='popover'][data-popover='active']").getAttribute("id"))}))},mousedown_close:t=>{t.target.querySelector("[data-module='popover'], [data-module='popover'] > *")&&e.action.close()},keyboard_focus_trap:t=>{t.keyCode===keyboard.keys.tab&&(t.shiftKey?document.activeElement===e.a11y.first_tab_stop&&(t.preventDefault(),e.a11y.last_tab_stop.focus()):document.activeElement===e.a11y.last_tab_stop&&(t.preventDefault(),e.a11y.first_tab_stop.focus())),t.keyCode===keyboard.keys.esc&&e.action.close()}},action:{open:(o,r)=>{const{el:a,focusable_elements:l,remove_focusable_elements:s}=t[o];document.removeEventListener("mousedown",e.event_listeners.mousedown_close),document.addEventListener("mousedown",e.event_listeners.mousedown_close),document.querySelectorAll("[data-popover='active']").forEach((e=>{e.removeAttribute("data-popover"),e.hidePopover()})),document.querySelectorAll("[data-popover-trigger='active']").forEach((e=>{e.removeAttribute("data-popover-trigger")})),l.forEach((e=>{e.setAttribute("tabindex","0")})),s.forEach((e=>{e.setAttribute("tabindex","-1")})),t[o].focusable_elements=[...l].filter((e=>![...s].includes(e))),e.a11y.focus_placeholder=document.activeElement,e.a11y.first_tab_stop=t[o].focusable_elements[0],e.a11y.last_tab_stop=t[o].focusable_elements[t[o].focusable_elements.length-1],a.setAttribute("data-popover","active"),r.setAttribute("data-popover-trigger","active"),e.ui.set_location(o),setTimeout((()=>{e.a11y.first_tab_stop&&e.a11y.first_tab_stop.focus()}),100),a.removeEventListener("keydown",e.event_listeners.keyboard_focus_trap),a.addEventListener("keydown",e.event_listeners.keyboard_focus_trap)},close:()=>{document.removeEventListener("mousedown",e.event_listeners.mousedown_close),document.querySelector("[data-module='popover'][data-popover='active']")?.setAttribute("tabIndex","-1"),document.querySelectorAll("[data-popover='active']").forEach((e=>{e.removeAttribute("data-popover"),e.hidePopover()})),document.querySelectorAll("[data-popover-trigger='active']").forEach((e=>{e.removeAttribute("data-popover-trigger")})),document.querySelectorAll("[data-target='popover']").forEach(((o,r)=>{const a=o.getAttribute("id"),{focusable_elements:l}=t[a];l.forEach((e=>{e.setAttribute("tabindex","-1")})),o.removeEventListener("keydown",e.event_listeners.keyboard_focus_trap)})),e.a11y.focus_placeholder.focus()}},a11y:{focus_placeholder:null,first_tab_stop:null,last_tab_stop:null,get_focusable_elements:e=>{const{el:o}=t[e];t[e].focusable_elements=o.querySelectorAll(focus_trap_selector),t[e].remove_focusable_elements=o.querySelectorAll(remove_focus_selector)}}}}));