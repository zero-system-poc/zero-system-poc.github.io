"use strict";chill_penguin.module("form.validation",(()=>{let e,t=!0,a=0,i={};return{initialize:()=>{e=chill_penguin.form.validation,i={},e.setup.initialize(),e.setup.inline_field_validation()},setup:{initialize:()=>{document.querySelectorAll("[data-module='form']").forEach(((t,a)=>{let r=t.getAttribute("name");i[r]={},document.querySelectorAll(`[data-module='form'][name=${r}] [data-required], [data-module='form'][name=${r}] [data-optional]`).forEach(((t,a)=>{let s=t.getAttribute("name");i[r][s]={type:e.setup.util.get_type(t),validation_necessity:e.setup.util.get_validation_necessity(t),validation_timing:e.setup.util.get_validation_timing(t),validation_criteria:t.getAttribute(`data-${e.setup.util.get_validation_necessity(t)}`).split(",")}}))}))},util:{get_type:e=>"input"===e.tagName.toLowerCase()&&e.hasAttribute("type")?e.getAttribute("type").toLowerCase():"select"===e.tagName.toLowerCase()?"dropdown":"textarea"===e.tagName.toLowerCase()?"text":void 0,get_validation_necessity:e=>e.hasAttribute("data-required")?"required":e.hasAttribute("data-optional")?"optional":"",get_validation_timing:e=>e.hasAttribute("data-validation-type")&&"inline"===e.getAttribute("data-validation-type")?"inline":"onsubmit"},inline_field_validation:()=>{document.querySelectorAll("[data-module='form']").forEach(((t,a)=>{const i=t.getAttribute("name");document.querySelectorAll(`[data-module='form'][name=${i}] [data-validation-type=inline][data-required],[data-module='form'][name=${i}] [data-validation-type=inline][data-optional]`).forEach(((t,a)=>{const r=t.getAttribute("name");e.type.inline(t,i,r),t.removeEventListener("keyup",e.event_listeners.inline.input.keyup),t.addEventListener("keyup",e.event_listeners.inline.input.keyup)}))}))}},event_listeners:{inline:{input:{keyup:t=>{const a=t.currentTarget,i=chill_penguin.util.closest_parent(t.target,"[data-module='form']").getAttribute("name"),r=a.getAttribute("name");e.type.inline(a,i,r)}}}},type:{inline:(t,a,r)=>{for(let s=0;s<i[a][r].validation_criteria.length;s++)if("equals"===i[a][r].validation_criteria[s]){t=document.querySelector(`[name='${r}']`);let a=document.getElementById(t.getAttribute("data-matching"));e.validate.string_value(t.value,"equals",a.value)?(document.getElementById(`${t.name}:equals`).parentNode.closest("li").classList.add("pass"),document.getElementById(`${t.name}:equals`).parentNode.closest("li").classList.remove("fail")):(document.getElementById(`${t.name}:equals`).parentNode.closest("li").classList.add("fail"),document.getElementById(`${t.name}:equals`).parentNode.closest("li").classList.remove("pass"))}else e.validate.string_value(t.value,i[a][r].validation_criteria[s])?(document.getElementById(`${r}:${i[a][r].validation_criteria[s]}`).parentNode.closest("li").classList.add("pass"),document.getElementById(`${r}:${i[a][r].validation_criteria[s]}`).parentNode.closest("li").classList.remove("fail")):(document.getElementById(`${r}:${i[a][r].validation_criteria[s]}`).parentNode.closest("li").classList.add("fail"),document.getElementById(`${r}:${i[a][r].validation_criteria[s]}`).parentNode.closest("li").classList.remove("pass"))},form:(r,s,n,l=[])=>{a=0,t=!0;let o=Object.keys(i[s]);for(let r=0;r<o.length;r++){for(let t=0;t<i[s][o[r]].validation_criteria.length;t++)e.ui.display_error_message(o[r],"equals",!0),e.ui.display_error_message(o[r],"is_not_empty",!0),e.ui.display_error_message(o[r],i[s][o[r]].validation_criteria[t],!0),e.ui.hightlight_error(o[r],i[s][o[r]].type,!0);for(let n=0;n<i[s][o[r]].validation_criteria.length;n++){let l=i[s][o[r]].type,u=i[s][o[r]].validation_necessity;if("required"===u){if(""===document.querySelector(`[name='${o[r]}']`).value||"radio"===l||"checkbox"===l)t=e.validate.input_type(o[r],l,"is_not_empty"),e.ui.display_error_message(o[r],"is_not_empty",t),e.ui.hightlight_error(o[r],l,t),a+=t?0:1;else if("equals"===i[s][o[r]].validation_criteria[n]){let i=document.querySelector(`[name='${o[r]}']`),s=document.getElementById(i.getAttribute("data-matching"));t=e.validate.string_value(i.value,"equals",s.value),a+=t?0:1,e.ui.display_error_message(o[r],"equals",t),e.ui.hightlight_error(o[r],l,t)}else if(t=e.validate.input_type(o[r],l,i[s][o[r]].validation_criteria[n]),a+=t?0:1,e.ui.display_error_message(o[r],i[s][o[r]].validation_criteria[n],t),!1===t){e.ui.hightlight_error(o[r],l,!1);break}}else if("optional"===u)if(""===document.querySelector(`[name='${o[r]}']`).value||"radio"===l||"checkbox"===l);else{if("equals"===i[s][o[r]].validation_criteria[n]){let a=document.querySelector(`[name='${o[r]}']`),i=document.getElementById(a.getAttribute("data-matching"));t=e.validate.string_value(a.value,"equals",i.value),e.ui.display_error_message(o[r],"equals",t),e.ui.hightlight_error(o[r],l,t)}else if(t=e.validate.input_type(o[r],l,i[s][o[r]].validation_criteria[n]),e.ui.display_error_message(o[r],i[s][o[r]].validation_criteria[n],t),!1===t){e.ui.hightlight_error(o[r],l,!1);break}a+=t?0:1}}}return 0===a&&("function"!=typeof n?(console.error("last on_success_function_object is not a function"),!1):"AsyncFunction"!==n.constructor.name?n():(r.preventDefault(),void(async()=>{try{let e=await n(...l);if("boolean"!=typeof e)return console.error("Result is not boolean"),e;if(!0!==e)return!1;document.getElementById(s).submit()}catch{return console.error("on_success_function await failed"),!1}})()))}},ui:{display_error_message:(e,t,a)=>{const i=document.getElementById(`${e}:${t}`);i&&(a?i.classList.remove("has-error"):i.classList.add("has-error"))},hightlight_error:(e,t,a)=>{if("text"===t||"number"===t||"dropdown"===t){const t=document.querySelector(`label[for='${e}']`);a?t.classList.remove("error-field"):t.classList.add("error-field")}}},validate:{input_type:(t,a,i)=>{let r,s=!1;if("radio"===a||"checkbox"===a){r=document.querySelectorAll(`[name='${t}']`);for(let e=0;e<r.length;e++)r[e].checked&&(s=!0);return s}if(r=document.querySelector(`[name='${t}']`),r)return e.validate.string_value(r.value,i)},string_value:(e,t,a)=>{let i;switch(t){case"is_not_empty":return""!==e;case"is_not_string_master":return"master"!==e;case"is_alphanumeric":return i=/^[A-Za-z\u00E0-\u00FC\d ]+$/,i.test(e);case"is_lowercase":return i=/^[a-z]+$/,i.test(e);case"is_lowercase_numbers_dash_underscore_comma":return i=/^[a-z0-9-_,]+$/,i.test(e);case"is_url_pathname_friendly":return i=/^[A-Za-z0-9\/\-_]+$/,i.test(e);case"is_url_folder_friendly_lowercase":return i=/^[a-z0-9\-_]+$/,i.test(e);case"is_url_pathname_friendly_lowercase":return i=/^[a-z0-9\-/_]+$/,i.test(e);case"is_number":return i=/^-?\d+$/,i.test(e);case"is_number_or_comma_separated_numbers":return i=/^\d+(,\d+)*$/,i.test(e);case"is_words_or_comma_separated_words":return i=/^[\w\d-]+(,[\w\d-]+)*$/,i.test(e);case"is_phone":return i=/^\s*(?:\+?(\d{1,3}))?[-. (]*(\d{3})[-. )]*(\d{3})[-. ]*(\d{4})(?: *x(\d+))?\s*$/,i.test(e);case"is_email":return i=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,i.test(e);case"is_postal-code":return i=/^[A-Za-z]\d[A-Za-z][ -]?\d[A-Za-z]\d$/,i.test(e);case"is_zipcode":return i=/(^\d{5}$)|(^\d{5}-\d{4}$)/,i.test(e);case"is_css_hexcode":return i=/^#([0-9a-fA-F]{6})$/,i.test(e);case"has_min_8_characters":return e.length>7;case"has_no_forward_slash":return i=/^[^/\\]+$/,i.test(e);case"has_no_double_forward_slash":return i=/^(?!.*\/\/).+$/,i.test(e);case"has_forward_slash_at_end":return"/"===e[e.length-1];case"has_no_forward_slash_at_start":return"/"!==e[0];case"has_min_1_number":return i=/[0-9]/i,i.test(e);case"has_min_1_special_character":return i=/\W/,i.test(e);case"has_min_1_lowercase_letter":return i=/[a-z]/,i.test(e);case"has_min_1_uppercase_letter":return i=/[A-Z]/,i.test(e);case"equals":return e===a;default:return!1}}}}}));